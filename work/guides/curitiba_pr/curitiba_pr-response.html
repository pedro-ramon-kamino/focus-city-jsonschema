<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        
        <title>Como emitir NFSe Nacional pela API da Focus NFe</title>
        <meta name="description" content="Veja como emitir NFSe Nacional pela API da Focus NFe. Guia técnico com documentação, json de exemplo e municípios aderentes.">
        

        

        <link rel="canonical" href="https://focusnfe.com.br/guides/nfse/municipios-integrados/municipios-da-nfse-nacional/">

        <!-- Favicon padrão -->
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicon/android-chrome-192x192.png">
        <link rel="icon" type="image/png" sizes="512x512" href="/assets/img/favicon/android-chrome-512x512.png">

        <!-- Ícone para Apple (iPhones e iPads) -->
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png">

        <!-- Favicon clássico para navegadores antigos -->
        <link rel="shortcut icon" href="/assets/img/favicon/favicon.ico">

        <!-- Metatags para redes sociais -->
        <meta property="og:image" content="https://focusnfe.com.br/assets/img/default-share-image.png" />
        <meta name="twitter:image" content="https://focusnfe.com.br/assets/img/default-share-image.png" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:type" content="website" />

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
        />

        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
        />
        <link rel="stylesheet" href="/assets/css/styles.css" />
        
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"
        ></script>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5ZH7WMQ');</script>
        <!-- End Google Tag Manager -->

    </head>

    <body class="body-guides bg-body" data-bs-theme="light">
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5ZH7WMQ"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->

        <header>
  <nav class="navbar navbar-expand-lg pb-md-4 pt-3 bg-body border-bottom">
    <div class="container justify-content-center justify-content-md-between">
      <a class="navbar-brand" href="/guides/">
        <svg width="250" version="1.1" viewBox="0 0 1889.8 425.95" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="a" x2="1" gradientTransform="matrix(239.59,-239.59,-239.59,-239.59,39.932,279.53)" gradientUnits="userSpaceOnUse"><stop stop-color="#f2521b" offset="0"/><stop stop-color="#f2521b" offset=".15"/><stop stop-color="#f57c1d" offset=".85"/><stop stop-color="#f57c1d" offset="1"/></linearGradient><clipPath id="b"><path d="m239.59 239.59v-137.79c0-12.118-9.824-21.943-21.942-21.943h-137.79v-79.864h146.1c8.729 0 17.101 3.468 23.274 9.6398l60.584 60.584c6.172 6.1719 9.64 14.545 9.64 23.274v146.1zm-119.8-119.8h79.865v79.865h-79.865zm-39.932 97.855v-137.79h-79.865v146.1c0 8.73 3.468 17.101 9.6402 23.274l60.584 60.584c6.1727 6.172 14.544 9.64 23.273 9.64h146.1v-79.864h-137.79c-12.118 0-21.942-9.824-21.942-21.943z"/></clipPath></defs><path transform="matrix(1.3333,0,0,-1.3333,0,425.95)" d="m239.59 239.59v-137.79c0-12.118-9.824-21.943-21.942-21.943h-137.79v-79.864h146.1c8.729 0 17.101 3.468 23.274 9.6398l60.584 60.584c6.172 6.1719 9.64 14.545 9.64 23.274v146.1zm-119.8-119.8h79.865v79.865h-79.865zm-39.932 97.855v-137.79h-79.865v146.1c0 8.73 3.468 17.101 9.6402 23.274l60.584 60.584c6.1727 6.172 14.544 9.64 23.273 9.64h146.1v-79.864h-137.79c-12.118 0-21.942-9.824-21.942-21.943" clip-path="url(#b)" fill="url(#a)"/><path d="m1317.4 181.22c21.006 0 34.406 10.392 34.406 17.545h36.052c0-29.951-30.946-53.412-70.458-53.412-39.514 0-70.464 23.461-70.464 53.412 0 44.508 46.035 50.421 68.154 53.261 36.715 4.7186 36.715 11.02 36.715 17.693 0 7.1518-13.4 17.545-34.406 17.545-21.007 0-34.408-10.393-34.408-17.545h-36.055c0 29.951 30.95 53.412 70.464 53.412 39.512 0 70.458-23.461 70.458-53.412 0-44.506-46.026-50.421-68.148-53.267-36.719-4.7132-36.719-11.016-36.719-17.688 0-7.1532 13.401-17.545 34.408-17.545zm254.85 118.48-119.77-151.45h-13.386v171.21h12.706v-151.44l119.78 151.44h13.373v-171.21h-12.706zm50.319 19.768h12.706v-77.187h80.211v-12.173h-80.211v-69.674h102.93v-12.18h-115.64zm253.87-89.596c-6.7332-28.401-32.066-49.532-62.358-49.532-30.292 0-55.612 21.137-62.372 49.532zm13.386 12.293h-139.81c-0.04 0.92531-0.1333 1.8346-0.1333 2.7693 0 35.674 28.746 64.593 64.198 64.593 21.573 0 40.612-10.735 52.252-27.145l10.88 4.8986c-13.613 20.491-36.799 33.996-63.132 33.996-41.906 0-75.878-34.18-75.878-76.343 0-42.163 33.972-76.342 75.878-76.342 40.986 0 74.292 32.705 75.745 73.573zm-1314.7-93.911h105.49v-41.532h-148.1v212.55h42.623v-69.886h81.45v-41.532h-81.45zm246.07 85.986c0-28.555-23.149-51.704-51.704-51.704-28.555 0-51.704 23.149-51.704 51.704 0 28.555 23.149 51.704 51.704 51.704 28.555 0 51.704-23.149 51.704-51.704zm37.186 0c0 49.092-39.798 88.89-88.89 88.89-49.092 0-88.89-39.798-88.89-88.89 0-49.092 39.798-88.888 88.89-88.888 49.092 0 88.89 39.796 88.89 88.888zm113.13-51.704c18.118 0 34.032 9.3358 43.266 23.441l29.457-22.753c-16.081-22.882-42.631-37.872-72.722-37.872-49.092 0-88.89 39.796-88.89 88.888 0 49.092 39.798 88.89 88.89 88.89 30.091 0 56.641-14.992 72.722-37.872l-29.457-22.754c-9.2331 14.105-25.147 23.441-43.266 23.441-28.557 0-51.703-23.149-51.703-51.704 0-28.555 23.146-51.704 51.703-51.704zm212.46-33.859h36.25v98.919c0 41.716-33.819 75.534-75.534 75.534-41.716 0-75.534-33.818-75.534-75.534v-98.919h36.248v98.542c0 21.695 17.589 39.284 39.286 39.284 21.695 0 39.284-17.589 39.284-39.284v-98.542" fill="currentColor" stroke-width="1.3333"/></svg>
      </a>
      <div class="d-flex flex-column flex-sm-row mt-4 mt-sm-0">
        <ul class="navbar-nav me-auto flex-row">
          <li class="nav-item mx-2">
            <a href="https://focusnfe.com.br/" class="link-body-emphasis text-decoration-none h6">Site Principal</a>
          </li>
          <li class="nav-item mx-2">
            <a href="https://focusnfe.com.br/doc/" target="_blank" class="link-body-emphasis text-decoration-none h6">Documentação da API</a>
          </li>
        </ul>
        <div class="form-check form-switch ms-md-3 align-self-center mt-3 mt-md-0">
          <input class="form-check-input" type="checkbox" role="switch" id="themeSwitch" style="background-color: var(--orange1);border-color: var(--orange1);">
          <label class="form-check-label" for="themeSwitch">
            <i id="themeIcon" class="bi"></i>
          </label>
        </div>
      </div>
    </div>
  </nav>
</header>

<div class="container">
  <div class="row">
    <div class="col-12 py-4">
      <a class="btn btn-link text-orange2 px-0 text-decoration-none fw-semibold" href="/guides/">
        <i class="bi bi-chevron-compact-left"></i> Voltar
      </a>
    </div>
  </div>
  <div class="row">
    <div class="col col-md-12 col-lg-9 mb-4 order-2 order-lg-1">
      <div class="guides-text__content text-body">
        <h1 id="como-emitir-nfse-no-ambiente-nacional"><strong>Como emitir NFSe no Ambiente Nacional</strong></h1>

<p>Este guia descreve, de forma técnica, como realizar a emissão de <strong>NFSe no Ambiente Nacional</strong> utilizando a API da Focus NFe. O conteúdo é voltado para integradores e desenvolvedores e aborda desde a habilitação do ambiente até particularidades operacionais exigidas por municípios aderentes.</p>

<h2 id="o-que-é-o-ambiente-nacional-da-nfse"><strong>O que é o Ambiente Nacional da NFSe</strong></h2>

<p>O <strong>Ambiente Nacional da NFS-e</strong> é a iniciativa do Governo Federal para padronizar a emissão de Notas Fiscais de Serviço Eletrônicas em um único layout e fluxo, substituindo gradualmente os emissores municipais individuais. Municípios que aderem ao projeto passam a aceitar a emissão por meio do emissor nacional, respeitando algumas parametrizações locais.</p>

<p>Portal oficial da NFSe Nacional:<br />
<a href="https://www.gov.br/nfse">https://www.gov.br/nfse</a></p>

<h2 id="quem-deve-emitir-nfse-no-ambiente-nacional"><strong>Quem deve emitir NFSe no Ambiente Nacional</strong></h2>

<p>Devem emitir NFSe no ambiente nacional as empresas estabelecidas em <strong>municípios que aderiram ao Emissor Nacional da NFS-e</strong>.</p>

<h3 id="mei-microempreendedor-individual"><strong>MEI (Microempreendedor Individual)</strong></h3>

<ul>
  <li>Para <strong>MEI</strong>, a emissão via Ambiente Nacional é <strong>obrigatória</strong> independente do município.</li>
</ul>

<h3 id="lista-de-municípios-aderentes"><strong>Lista de Municípios Aderentes</strong></h3>

<p>A relação oficial de municípios pode ser consultada no portal da NFSe Nacional:</p>

<p><a href="https://app.powerbi.com/view?r=eyJrIjoiNGQ4YTcxNmMtMzdhNC00Mzc5LTllM2EtMjY1MTM3NWQyZDgyIiwidCI6IjZmNDlhYTQzLTgyMmEtNGMyMC05NjcwLWRiNzcwMGJmMWViMCJ9&amp;pageName=608609c2e0a53d7a3c6e"><strong>[ Dashboard - Monitoramento de Adesão dos Municípios à NFSe ]</strong></a></p>

<p>No gráfico <em>“Adesão ao Emissor Nacional da NFS-e”</em>, clique na área azul escuro para filtrar apenas os municípios aderentes.</p>

<p>O portal também <a href="https://www.gov.br/nfse/pt-br/municipios/monitoramento-adesoes">disponibiliza</a> uma planilha atualizada frequentemente, basta filtrar pela coluna <em>AderenteEmissorNacional</em>.</p>

<h2 id="habilitação-do-ambiente-nacional-na-focus-nfe"><strong>Habilitação do Ambiente Nacional na Focus NFe</strong></h2>

<p>Antes de emitir NFSe Nacional, é necessário habilitar o ambiente para a empresa.</p>

<h3 id="via-painel-da-api"><strong>Via Painel da API</strong></h3>

<ol>
  <li>Acesse:<br />
<a href="https://app-v2.focusnfe.com.br/minhas_empresas/empresas">https://app-v2.focusnfe.com.br/minhas_empresas/empresas</a></li>
  <li>Localize e edite a empresa desejada</li>
  <li>Acesse a aba <strong>Documentos Fiscais</strong></li>
  <li>Habilite os parâmetros:
    <ul>
      <li><strong>Ambiente da NFSe Nacional – Homologação</strong></li>
      <li><strong>Ambiente da NFSe Nacional – Produção</strong></li>
    </ul>
  </li>
</ol>

<h3 id="via-api-de-empresas"><strong>Via API de Empresas</strong></h3>

<p>Na criação ou atualização da empresa, utilize os parâmetros:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">habilita_nfsen_homologacao</code></li>
  <li><code class="language-plaintext highlighter-rouge">habilita_nfsen_producao</code></li>
</ul>

<p>Documentação:<br />
https://doc.focusnfe.com.br/reference/atualizarempresa</p>

<h2 id="documentação-completa-da-nfse-nacional"><strong>Documentação completa da NFSe Nacional</strong></h2>

<p>A documentação técnica oficial do projeto, incluindo layouts, schemas, regras de negócio e notas técnicas, está disponível em:</p>

<p>https://www.gov.br/nfse/pt-br/biblioteca/documentacao-tecnica</p>

<p>Para a implementação via Focus NFe, utilize como referência principal:</p>

<p><a href="https://doc.focusnfe.com.br/reference/enviardpsnacional">https://doc.focusnfe.com.br/reference/enviardpsnacional</a></p>

<h2 id="endpoint-correto-para-nfse-nacional"><strong>Endpoint correto para NFSe Nacional</strong></h2>

<p>A NFS-e Nacional possui <strong>ambiente, endpoint e payload específicos</strong>, diferentes da NFSe municipal tradicional.</p>

<p><strong>Endpoint base:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://api.focusnfe.com.br/v2/nfsen
</code></pre></div></div>

<p>É importante garantir que sua integração esteja apontando para esse endpoint ao emitir NFSe no ambiente nacional.</p>

<h2 id="exemplo-de-json-para-envio-de-dps-nacional"><strong>Exemplo de JSON para envio de DPS Nacional</strong></h2>

<p>Exemplo de payload para emissão de uma <strong>DPS (Declaração de Prestação de Serviço)</strong> no ambiente nacional:</p>

<style>
  .copy-btn {
    border: none;
    color: white;
    padding: 5px;   /* reduzido */
    font-size: 14px;        /* menor fonte */
    border-radius: 0.2rem;
  }          
  .copy-btn:hover {
    background-color: var(--cinza);
    color: white;
  }
  .nav-tabs {
    border-color: transparent;
  }
  .nav-tabs .nav-item:first-child .nav-link {
    margin-left: 0.75rem;
  }
  .nav-tabs .nav-item .nav-link:hover {
    border-color: #6c757d;
    border-bottom-color: transparent;
    color: var(--cinza-claro);
  }
  .json-box {
    background-color: #1e1e1e;
    color: #ffffff;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    word-wrap: break-word;
    position: relative;
  }
  pre {
    margin: 0;
    font-family: Consolas, Monaco, 'Courier New', monospace;
  }
</style>

<div class="row">
  <div class="col-12">
    <div class="card mb-4 text-body bg-body-secondary">
      <div class="card-body">
        <h2 class="section-title fs-4 mb-3"><i class="bi bi-code-square"></i> JSONs de Exemplo</h2>
        <ul class="nav nav-tabs" id="tab-6057-tabs" role="tablist">
          <li class="nav-item" role="presentation">
  <button class="nav-link active text-body" id="tab-6057-tab-0" data-bs-toggle="tab" data-bs-target="#tab-6057-pane-0" type="button" role="tab">
    Padrão
  </button>
</li>
<li class="nav-item" role="presentation">
  <button class="nav-link  text-body" id="tab-6057-tab-1" data-bs-toggle="tab" data-bs-target="#tab-6057-pane-1" type="button" role="tab">
    Tomador Estrangeiro
  </button>
</li>

        </ul>
        <div class="tab-content" id="tab-6057-content">
          <div class="tab-pane fade show active" id="tab-6057-pane-0" role="tabpanel">
  <div class="json-box mt-0 position-relative bg-body text-body">
    <button class="btn btn-sm btn-outline-light copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-copy"></i> Copiar</button>
    <pre><code>{
  "data_emissao": "2026-01-13T11:16:06-03:00",
  "data_competencia": "2026-01-13",
  "codigo_municipio_emissora": 4314902,
  "cnpj_prestador": "00000000000000",
  "codigo_opcao_simples_nacional": 1,
  "regime_especial_tributacao": 0,
  "cnpj_tomador": "00000000000000",
  "razao_social_tomador": "RAZAO SOCIAL TOMADOR LTDA",
  "codigo_municipio_tomador": 4314902,
  "cep_tomador": "00000000",
  "logradouro_tomador": "AVENIDA EXEMPLO",
  "numero_tomador": "000",
  "complemento_tomador": "-",
  "bairro_tomador": "BAIRRO EXEMPLO",
  "telefone_tomador": "0000000000",
  "email_tomador": "contato@exemplo.org.br",
  "codigo_municipio_prestacao": 4314902,
  "codigo_tributacao_nacional_iss": "130501",
  "codigo_nbs": "121012200",
  "descricao_servico": "DESCRICAO EXEMPLO",
  "valor_servico": 60,
  "valor_iss": 1.5,
  "tributacao_iss": 1,
  "tipo_retencao_iss": 1,
  "percentual_total_tributos_federais": "10.38",
  "percentual_total_tributos_estaduais": "0.00",
  "percentual_total_tributos_municipais": "2.50",
  "situacao_tributaria_pis_cofins": "00",
  "indicador_total_tributacao": null
}</code></pre>
  </div>
</div>
<div class="tab-pane fade " id="tab-6057-pane-1" role="tabpanel">
  <div class="json-box mt-0 position-relative bg-body text-body">
    <button class="btn btn-sm btn-outline-light copy-btn" onclick="copyCode(this)" style="position: absolute; top: 0.5rem; right: 0.5rem;"><i class="bi bi-copy"></i> Copiar</button>
    <pre><code>{
  "data_emissao": "2026-01-08T15:11:29-03:00",
  "serie_dps": "900",
  "numero_dps": "1",
  "data_competencia": "2026-01-08",
  "codigo_municipio_emissora": "4125506",
  "cnpj_prestador": "00000000000000",
  "telefone_prestador": "0000000000",
  "email_prestador": "contato@exemplo.com.br",
  "codigo_opcao_simples_nacional": "1",
  "regime_especial_tributacao": "0",
  "nif_tomador": "00000",
  "razao_social_tomador": "RAZAO SOCIAL TOMADOR ESTRANGEIRO",
  "codigo_pais_ext_tomador": "HK",
  "cep_ext_tomador": "00000000",
  "nome_cidade_ext_tomador": "CIDADE EXTERIOR EXEMPLO",
  "regiao_ext_tomador": "REGIAO EXTERIOR EXEMPLO",
  "logradouro_tomador": "ENDERECO EXTERIOR EXEMPLO",
  "numero_tomador": "0",
  "bairro_tomador": "BAIRRO EXEMPLO",
  "codigo_municipio_prestacao": "4125506",
  "codigo_tributacao_nacional_iss": "110401",
  "descricao_servico": "DESCRICAO EXEMPLO",
  "codigo_nbs": "106029000",
  "modo_prestacao": "2",
  "vinculo_negocio": "0",
  "codigo_moeda": "790",
  "valor_servico_ext": "1.00",
  "mecanismo_comercio_ext_prestador": "01",
  "mecanismo_comercio_ext_tomador": "01",
  "movimentacao_temporaria_bens": "1",
  "mdic": "0",
  "valor_servico": "1.00",
  "tributacao_iss": "1",
  "tipo_retencao_iss": "1",
  "situacao_tributaria_pis_cofins": "06",
  "base_calculo_pis_cofins": "1.00",
  "aliquota_pis": "0.00",
  "aliquota_cofins": "0.00",
  "valor_pis": "0.00",
  "valor_cofins": "0.00",
  "tipo_retencao_pis_cofins": "2",
  "percentual_total_tributos_federais": "1.00",
  "percentual_total_tributos_estaduais": "2.00",
  "percentual_total_tributos_municipais": "3.00",
  "indicador_total_tributacao": null
}</code></pre>
  </div>
</div>

        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function copyCode(button) {
    const pre = button.closest(".tab-pane").querySelector("pre code");
    const text = pre.innerText;
    navigator.clipboard.writeText(text)
  }
</script>

<h2 id="inscrição-municipal-im-atenção-especial"><strong>Inscrição Municipal (IM): atenção especial</strong></h2>

<p>O campo <code class="language-plaintext highlighter-rouge">inscricao_municipal_prestador</code> gera um volume significativo de dúvidas e chamados de suporte.</p>

<p>Em <strong>alguns municípios</strong>, a prefeitura <strong>não cadastrou a Inscrição Municipal do prestador no ambiente nacional</strong>. Nesses casos o campo <code class="language-plaintext highlighter-rouge">inscricao_municipal_prestador</code> deve ser suprimido. Essa regra é válida apenas quando o município não possui a IM registrada no emissor nacional.</p>

<h2 id="particularidades-do-ambiente-nacional"><strong>Particularidades do Ambiente Nacional</strong></h2>

<h3 id="certificado-digital"><strong>Certificado digital</strong></h3>

<ul>
  <li>O certificado deve ser <strong>específico da empresa emissora</strong>.</li>
  <li>Não é permitido utilizar apenas a raiz do certificado (exemplo: certificado da matriz para filial ou vice-versa).</li>
</ul>

<h3 id="cancelamento"><strong>Cancelamento</strong></h3>

<ul>
  <li><strong>Todas as cidades aderentes aceitam cancelamento</strong> de NFS-e no modelo nacional.</li>
</ul>

<h3 id="substituição"><strong>Substituição</strong></h3>

<ul>
  <li>O modelo nacional <strong>aceita NFS-e de substituição</strong>.</li>
</ul>

<h3 id="emissão-sem-tomador-identificado"><strong>Emissão sem tomador identificado</strong></h3>

<ul>
  <li>É permitido emitir NFS-e <strong>sem identificação do tomador</strong>.</li>
</ul>

<h3 id="campos-opcionais-que-podem-se-tornar-obrigatórios"><strong>Campos opcionais que podem se tornar obrigatórios</strong></h3>

<p>Quando um município adere ao ambiente nacional, ele realiza um cadastro e define <strong>parametrizações próprias</strong>. Com isso, alguns campos que são <strong>opcionais no schema nacional</strong> podem se tornar <strong>obrigatórios para aquele município específico</strong>.</p>

<p>Exemplo comum:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">codigo_tributacao_municipal_iss</code></li>
</ul>

<p>Caso o campo exigido não seja enviado, a emissão será rejeitada pelo município.</p>

<h2 id="códigos-de-serviço-e-nbs"><strong>Códigos de serviço e NBS</strong></h2>

<h3 id="lista-de-códigos-de-serviço-com-desdobramento-nacional"><strong>Lista de códigos de serviço com desdobramento nacional</strong></h3>

<p>Disponível em:<br />
<a href="https://www.gov.br/nfse/pt-br/biblioteca/documentacao-tecnica/documentacao-atual/anexo_b-nbs2-lista_servico_nacional-snnfse.xlsx">https://www.gov.br/nfse/pt-br/biblioteca/documentacao-tecnica/documentacao-atual/anexo_b-nbs2-lista_servico_nacional-snnfse.xlsx</a></p>

<h3 id="tabela-de-correlação-indicador-de-operação-nbs-e-item-da-lista-de-serviço"><strong>Tabela de correlação: indicador de operação, NBS e item da lista de serviço</strong></h3>

<p>Disponível em:<br />
<a href="https://www.gov.br/nfse/pt-br/biblioteca/documentacao-tecnica/rtc/anexoviii-correlacaoitemnbsindopcclasstrib_ibscbs_v1-00-00.xlsx">https://www.gov.br/nfse/pt-br/biblioteca/documentacao-tecnica/rtc/anexoviii-correlacaoitemnbsindopcclasstrib_ibscbs_v1-00-00.xlsx</a></p>

<p>Essas tabelas são essenciais para o correto preenchimento dos campos:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">codigo_nbs</code></li>
  <li>Indicador de operação</li>
  <li>Item da lista de serviço</li>
</ul>

<h2 id="conclusão"><strong>Conclusão</strong></h2>

<p>A emissão de NFSe no Ambiente Nacional traz padronização, mas também exige atenção a regras específicas de cada município aderente. Garantir a habilitação correta do ambiente, o uso do endpoint adequado e o preenchimento correto de campos como <strong>Inscrição Municipal</strong>, <strong>códigos de serviço</strong> e <strong>NBS</strong> é fundamental para evitar rejeições e retrabalho.</p>

<p>Para mais detalhes técnicos, consulte sempre a documentação oficial da Focus NFe e do projeto NFSe Nacional.</p>

      </div>
    </div>
    <div class="col mb-4 mb-lg-0 order-1 order-lg-2">
      <nav id="guides-nav-text" class="bg-body-secondary body">
        <div class="row">
          <div class="col-12">
            <div class="row align-items-center mb-4">
              <div class="col-auto">
                <i class="bi bi-bookmark display-6 text-body"></i>
              </div>
              <div class="col">
                <h2 class="fs-4 fw-700 text-body">Sumário</h2>
              </div>
            </div>
          </div>
        </div>
        <div class="guides-nav-itens orange-scroll-default">
            <div class="row">
                <div class="col-12">
                    <ul class="guides-sidebar__list"></ul>
                </div>
            </div>
        </div>        
      </nav>
    </div>
  </div>
</div>

<script>
// Objeto para rastrear a contagem de IDs já utilizados em todos os cabeçalhos.
const usedIds = {};

// Função para criar o sumário dinamicamente
function generateTOC() {
    const toc = document.querySelector('#guides-nav-text ul');
    // Seleciona h2 e h3. Se você usa h4 (como sugere a sua lógica de clique), inclua-o aqui também.
    const headers = document.querySelectorAll('.guides-text__content h2, .guides-text__content h3'); 

    headers.forEach(header => {
        const level = header.tagName.toLowerCase();
        const text = header.innerText;

        // 1. Gera o ID base (slug)
        let baseId = text.toLowerCase()
            .replace(/[^\w\s-]/g, '') // Remove pontuações/caracteres especiais
            .replace(/\s+/g, '-')     // Substitui espaços por hífen
            .replace(/-+$/, '');      // Remove hífen do final (se houver)

        // 2. Lógica para garantir Unicidade do ID
        let id = baseId;
        if (usedIds[baseId] > 0) {
            // Se já foi usado, incrementa o contador e cria um ID único com sufixo numérico.
            usedIds[baseId]++;
            // O sufixo começa em -1 para o primeiro duplicado.
            id = `${baseId}-${usedIds[baseId] - 1}`; 
        } else {
            // Primeiro uso do ID base (ou se o ID não for válido, será 1).
            usedIds[baseId] = 1;
        }

        // 3. Aplica o ID único ao cabeçalho (corpo do guia)
        header.id = id;

        // 4. Criação do item do Sumário (TOC)
        const li = document.createElement('li');
        li.classList.add(level);
        const a = document.createElement('a');
        a.href = `#${id}`;
        a.innerText = text;
        a.classList.add('text-body'); 
        li.appendChild(a);
        toc.appendChild(li);
        
        // Adiciona evento de clique no título
        a.addEventListener('click', (event) => {
            event.preventDefault(); 
            removeActiveClasses(); 
            
            // Se o título for h4, ativa o h3 anterior
            if (level === 'h4') {
                let previousH3 = header.previousElementSibling;
                while (previousH3 && previousH3.tagName.toLowerCase() !== 'h3') {
                    previousH3 = previousH3.previousElementSibling; 
                }
                if (previousH3) {
                    const previousH3Id = previousH3.id;
                    const previousH3Link = document.querySelector(`#guides-nav-text ul li a[href="#${previousH3Id}"]`);
                    if (previousH3Link) {
                        previousH3Link.parentElement.classList.add('active');
                    }
                }
            } else {
                li.classList.add('active'); 
            }

            // Faz a rolagem suave para o cabeçalho correspondente
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
            lastActiveHeader = li; 
            isClicked = true; 
        });
    });
}

// --- Funções Auxiliares (Não Modificadas) ---

// Função para remover a classe ativa de todos os links do sumário
function removeActiveClasses() {
    document.querySelectorAll('#guides-nav-text ul li').forEach(li => {
        li.classList.remove('active');
    });
}

// Variáveis para controlar o estado do título ativo
let lastActiveHeader = null; // Variável para armazenar o último cabeçalho ativo
let isClicked = false; // Variável para verificar se um título foi clicado

// Função para destacar o título no sumário e rolar o sumário
function observeHeaders() {
    // Note que a seleção aqui deve ser consistente com generateTOC()
    const headers = document.querySelectorAll('.guides-text__content h2, .guides-text__content h3'); 
    let lastScrollTop = 0; 

    window.addEventListener('scroll', () => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        let activeHeader = null;

        headers.forEach((header) => {
            const rect = header.getBoundingClientRect();
            const headerTop = rect.top + scrollTop; 
            
            // Verifica se o cabeçalho está a 50px do topo da tela
            if (headerTop <= scrollTop + 50 && rect.bottom > 0) {
                activeHeader = header; 
            }
        });

        // Se não houve um clique recente, atualize a lógica do scroll
        if (!isClicked) {
            if (activeHeader) {
                const id = activeHeader.id;
                const tocLink = document.querySelector(`#guides-nav-text ul li a[href="#${id}"]`);
                if (tocLink) {
                    removeActiveClasses(); 
                    tocLink.parentElement.classList.add('active'); 
                    lastActiveHeader = tocLink.parentElement; 
                    scrollTOCToActive(tocLink.parentElement); 
                }
            } else if (lastActiveHeader) {
                lastActiveHeader.classList.add('active'); 
            }
        }

        // Lógica para scroll para cima e ajuste (mantida a original)
        if (scrollTop < lastScrollTop) {
            let closestHeader = null;
            headers.forEach((header) => {
                const rect = header.getBoundingClientRect();
                const headerTop = rect.top + scrollTop;

                if (headerTop <= scrollTop + 50 && rect.bottom > 0) {
                    closestHeader = header; 
                }
            });

            if (closestHeader) {
                const id = closestHeader.id;
                const tocLink = document.querySelector(`#guides-nav-text ul li a[href="#${id}"]`);
                if (tocLink) {
                    removeActiveClasses(); 
                    tocLink.parentElement.classList.add('active'); 
                    lastActiveHeader = tocLink.parentElement; 
                    scrollTOCToActive(tocLink.parentElement); 
                }
            }
        }

        // Verifica se o scroll chegou ao fim da página (mantida a original)
        if ((window.innerHeight + scrollTop) >= document.body.offsetHeight) {
            let lastVisibleHeader = null;
            headers.forEach((header) => {
                const rect = header.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    lastVisibleHeader = header; 
                }
            });

            if (lastVisibleHeader) {
                const id = lastVisibleHeader.id;
                const tocLink = document.querySelector(`#guides-nav-text ul li a[href="#${id}"]`);
                if (tocLink) {
                    removeActiveClasses(); 
                    tocLink.parentElement.classList.add('active'); 
                    lastActiveHeader = tocLink.parentElement; 
                    scrollTOCToActive(tocLink.parentElement); 
                }
            }
        }

        lastScrollTop = scrollTop; 
    });
}

// Função para rolar o sumário para o item ativo
function scrollTOCToActive(activeItem) {
    const toc = document.querySelector('.guides-nav-itens');
    const tocRect = toc.getBoundingClientRect();
    const activeRect = activeItem.getBoundingClientRect();

    if (activeRect.top < tocRect.top || activeRect.bottom > tocRect.bottom) {
        toc.scrollTop += activeRect.top - tocRect.top; 
    }
}

// Reseta a variável isClicked ao scrollar
window.addEventListener('scroll', () => {
    if (isClicked) {
        // Um pequeno timeout para garantir que o scroll suave termine antes de reativar a observação
        setTimeout(() => {
            isClicked = false;
        }, 300); 
    }
});

// --- Inicialização do Script ---

// Chama as funções quando o DOM estiver completamente carregado
document.addEventListener('DOMContentLoaded', () => {
    generateTOC();
    observeHeaders();
});

// Adiciona classes Bootstrap a todas as tabelas dentro do conteúdo (mantida a original)
document.addEventListener('DOMContentLoaded', () => {
  const tables = document.querySelectorAll('.guides-text__content table');

  tables.forEach((table) => {
    // Adiciona as classes do Bootstrap
    table.classList.add('table', 'table-bordered');

    // Cria o div com a classe table-responsive
    const wrapper = document.createElement('div');
    wrapper.classList.add('table-responsive');

    // Insere o wrapper no DOM antes da tabela
    table.parentNode.insertBefore(wrapper, table);

    // Move a tabela para dentro do wrapper
    wrapper.appendChild(table);
  });
});
</script>


<!-- Script para modo claro/escuro do guides -->
<script>
  const themeSwitch = document.getElementById('themeSwitch');
  const themeIcon = document.getElementById('themeIcon');
  const body = document.body;
  const savedTheme = localStorage.getItem('theme') || 'light';

  function updateIcon(theme) {
    themeIcon.className = theme === 'dark'
      ? 'bi bi-sun-fill'
      : 'bi bi-moon-stars-fill';
  }

  body.setAttribute('data-bs-theme', savedTheme);
  themeSwitch.checked = savedTheme === 'dark';
  updateIcon(savedTheme);

  themeSwitch.addEventListener('change', () => {
    const nextTheme = themeSwitch.checked ? 'dark' : 'light';
    body.setAttribute('data-bs-theme', nextTheme);
    localStorage.setItem('theme', nextTheme);
    updateIcon(nextTheme);
  });
</script>

        
        <!-- Script do Active Campaign -->
        <script>
            (function(e,t,o,n,p,r,i){e.visitorGlobalObjectAlias=n;e[e.visitorGlobalObjectAlias]=e[e.visitorGlobalObjectAlias]||function(){(e[e.visitorGlobalObjectAlias].q=e[e.visitorGlobalObjectAlias].q||[]).push(arguments)};e[e.visitorGlobalObjectAlias].l=(new Date).getTime();r=t.createElement("script");r.src=o;r.async=true;i=t.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)})(window,document,"https://diffuser-cdn.app-us1.com/diffuser/diffuser.js","vgo");
            vgo('setAccount', '69126782');
            vgo('setTrackByDefault', true);

            vgo('process');
        </script>
        <!-- End Script do Active Campaign -->
    </body>
</html>
